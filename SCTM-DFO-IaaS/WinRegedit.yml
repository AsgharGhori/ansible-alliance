# Task Script
# Contains Tasks for handling all windows registry
# editing. Called from a List Script

# Expected vars/facts:
# - MachineDefaults (populated)
# - Rollbacks
# - Skips
# - SecCat
# - TaskCat
# - RegTask (many)
#   - ID
#   - RegPath
#   - RegName
#   - RegType
#   - Value
#   - Desc
---
- set_fact:
    taskName: "{{ SecCat+'_'+TaskCat+' '+RegTask.ID+' > '+RegTask.Desc }}"
    skipVar: "{{ SecCat+'_'+TaskCat+'_'+RegTask.ID }}"

- name: "{{RegTask.Desc}}"
  debug:
    msg: "{{RegTask.Desc}}"

- name: "{{taskName}}"
  win_regedit:
    path: "{{RegTask.RegPath}}"
    name: "{{RegTask.RegName}}"
    data: "{{ RegTask.Value if SecCat+'_'+TaskCat not in Rollbacks else MachineDefaults[SecCat+'_'+TaskCat][RegTask.ID] }}"
    type: "{{RegTask.RegType}}"
    state: "{{ 'absent' if SecCat+'_'+TaskCat not in Rollbacks and MachineDefaults[SecCat+'_'+TaskCat][RegTask.ID] == 4294967295 else 'present' }}"
  when: skipVar not in Skips