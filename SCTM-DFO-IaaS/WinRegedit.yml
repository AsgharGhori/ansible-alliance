# Task Script
# Contains Tasks for handling all windows registry
# editing. Called from a List Script

# Expected vars/facts:
# - MachineDefaults (populated)
# - SecCat
# - TaskCat
# - RegTask (many)
#   - ID
#   - RegPath
#   - RegName
#   - RegType
#   - Value
#   - Desc
---
- name: "{{SecCat}}_{{TaskCat}} {{RegTask.TaskID}} > {{RegTask.Desc}}"
  win_regedit:
    path: "{{RegTask.RegPath}}"
    name: "{{RegTask.RegName}}"
    data: "{{RegTask.Value}} if undo_{{SecCat}}_{{TaskCat}} is not defined else MachineDefaults.{{SecCat}}_{{TaskCat}}.{{RegTask.ID}}"
    type: "{{RegTask.RegType}}"
    state: "{{absent if (undo_{{SecCat}}_{{TaskCat}} is defined and MachineDefaults.{{SecCat}}_{{TaskCat}}.{{RegTask.ID}} == 4294967295) else present}}"
  # when: "skip_{{SecCat}}_{{TaskCat}}_{{RegTask.ID}} is not defined"