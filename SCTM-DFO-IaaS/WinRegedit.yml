# Task Script
# Contains Tasks for handling all windows registry editing.
# Called from a List Script

# Expected vars/facts:
# - MachineDefaults {} (populated and with SecCat_TaskCat: {} entry)
# - Rollbacks []
# - Skips []
# - SecCat
# - TaskCat
# - RegTask {} (looped)
#   - Desc
#   - ID
#   - Name
#   - Path
#   - Type
#   - Value
---
- set_fact:
    skipVar: "{{SecCat+'_'+TaskCat+'_'+RegTask.ID}}"

- name: "{{SecCat+'_'+TaskCat+' '+RegTask.ID+' > '+RegTask.Desc}}"
  win_regedit:
    path: "{{ RegTask.Path }}"
    name: "{{ RegTask.Name }}"
    data: "{{ RegTask.Value if SecCat+'_'+TaskCat not in Rollbacks else
      MachineDefaults[SecCat+'_'+TaskCat][RegTask.ID] }}"
    type: "{{RegTask.Type}}"
    state: "{{ 'absent' if SecCat+'_'+TaskCat not in Rollbacks and
      MachineDefaults[SecCat+'_'+TaskCat][RegTask.ID] == 4294967295 else 'present' }}"
  when: skipVar not in Skips