# List Script
# Includes all the tasks that fall under
# the Unclassed AC-3 protocol requirements

# Expected vars/facts:
# - MachineDefaults {} (populated)
---
# Init task dictionaries
- name: Set AC-3 regedit task dictionary
  sef_fact:
    UN_AC_3_RegTasks:
    - { ID: A, Value: 1, Type: dword, Name: LimitBlankPasswordUse, 
    Path: 'HKLM:\SYSTEM\CurrentControlSet\Control\Lsa', 
    Desc: Restrict use of blank passwords }
    - { ID: B, Value: 1, Type: dword, Name: AddPrinterDrivers, 
    Path: 'HKLM:\SYSTEM\CurrentControlSet\Control\Print\Providers\LanMan Print Services\Servers', 
    Desc: Prevent printer driver installation for non-admins }
    - { ID: C, Value: 1, Type: dword, Name: RequireSignOrSeal, 
    Path: 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters', 
    Desc: Enforce encrypted or signed channel data }
    - { ID: D, Value: 1, Type: dword, Name: SignSecureChannel, 
    Path: 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters', 
    Desc: Enforce encrypted of signed channel data }
    - { ID: E, Value: 1, Type: dword, Name: dontdisplaylastusername, 
    Path: 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System', 
    Desc: Do not display last user name }
    - { ID: F, Value: 1, Type: dword, Name: disabledcad, 
    Path: 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System', 
    Desc: Require CTRL + ALT + DEL to logon }
    - { ID: G, Value: 1, Type: dword, Name: EnableSecuritySignature, 
    Path: 'HKLM:\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters', 
    Desc: Enforce digital signing of communications (Workstation) }
    - { ID: H, Value: 1, Type: dword, Name: enablesecuritysignature, 
    Path: 'HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters', 
    Desc: Enforce digital signing of communications (Server) }
    - { ID: I, Value: 1, Type: dword, Name: SafeDllSearchMode, 
    Path: 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager', 
    Desc: Allow SafeDLL search mode }
    - { ID: J, Value: 4, Type: dword, Name: ScreenSaverGracePeriod, 
    Path: 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon', 
    Desc: Set screen saver grace period to 4 }
    - { ID: K, Value: 1, Type: dword, Name: restrictanonymoussam, 
    Path: 'HKLM:\SYSTEM\CurrentControlSet\Control\Lsa', 
    Desc: Prevent SAM account searching }
    - { ID: L, Value: 0, Type: dword, Name: everyoneincludesanonymous, 
    Path: 'HKLM:\SYSTEM\CurrentControlSet\Control\Lsa', 
    Desc: Restrict anonymous user permissions }
    - { ID: M, Value: 1, Type: dword, Name: restrictnullsessaccess, 
    Path: 'HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters', 
    Desc: Restrict anonymous access to pipes }
    - { ID: 'N', Value: 1, Type: dword, Name: ldapclientintegrity, 
    Path: 'HKLM:\SYSTEM\CurrentControlSet\Services\ldap', 
    Desc: Enforce LDAP client signing }
    - { ID: O, Value: 0, Type: dword, Name: shutdownwithoutlogon, 
    Path: 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System', 
    Desc: Allow system shutdown without logon }
    - { ID: P, Value: 0, Type: dword, Name: EnableUIADesktopToggle, 
    Path: 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System', 
    Desc: Prevent unsecure elevation prompts from applications }
    - { ID: Q, Value: 1, Type: dword, Name: EnableInstallerDetection, 
    Path: 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System', 
    Desc: Prevent application installation without prompt }
    - { ID: R, Value: 1, Type: dword, Name: EnableLUA, 
    Path: 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System', 
    Desc: Run admins in Admin Approval Mode }
    - { ID: S, Value: 1, Type: dword, Name: PromptOnSecureDesktop, 
    Path: 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System', 
    Desc: Enforce secure desktop for elevation prompts }
    - { ID: T, Value: 1, Type: dword, Name: EnableVirtualization, 
    Path: 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System', 
    Desc: Restrict legacy application registry write locations }
    - { ID: OO, Value: 3, Type: dword, Name: noconnecteduser, 
    Path: 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System', 
    Desc: Prevent Microsoft accounts from logging in }
    - { ID: PP, Value: 0, Type: dword, Name: submitcontrol, 
    Path: 'HKLM:\SYSTEM\CurrentControlSet\Control\Lsa', 
    Desc: Prohibit server controllers from scheduling tasks }
    - { ID: QQ, Value: '', Type: multistring, Name: NullSessionPipes, 
    Path: 'HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters', 
    Desc: Prohibit anonymous access to names pipes }
    - { ID: RR, Value: '', Type: multistring, Name: NullSessionShares, 
    Path: 'HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters', 
    Desc: Prohibit anonymous access to session shares }
    - { ID: SS, Value: 1, Type: dword, Name: DisableAutomaticRestartSignOn, 
    Path: 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System', 
    Desc: Prevent last user's credentials from being stored }
    - { ID: TT, Value: 1, Type: dword, Name: EnableAuthEpResolution , 
    Path: 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Rpc', 
    Desc: Require authentication for RPC service access }
    - { ID: UU, Value: 1, Type: dword, Name: ForceUnlockLogon, 
    Path: 'HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', 
    Desc: Require Domain Controller Authentication to unlock computer }

- name: Set AC-3 user rights task dictionary
  set_fact:
    UN_AC_3_RightsTasks:
    - { Desc: Set no one to act as part of the operating system,
    ID: U, Name: SeTcbPrivilege, 
    Users: [] }
    - { Desc: Set Administrators to log on locally,
    ID: V, Name: SeInteractiveLogonRight, 
    Users: ['Administrators'] }
    - { Desc: Allow Admins and Remote users to log on with RDP,
    ID: W, Name: SeRemoteInteractiveLogonRight, 
    Users: ['Administrators','Remote Desktop 
    Users'] }
    - { Desc: Only Admins and local service can change system time,
    ID: X, Name: SeSystemtimePrivilege, 
    Users: ['Administrators','Local Service'] }
    - { Desc: Restrict pagefile creation to Admins,
    ID: 'Y', Name: SeCreatePagefilePrivilege, 
    Users: ['Administrators'] }
    - { Desc: "Allow Admins, Service, Local Service and Network Service to create global objects",
    ID: Z, Name: SeCreateGlobalPrivilege, 
    Users: ['Administrators','Service','Local Service','Network Service'] }
    - { Desc: "Set deny computer access via network for Guests",
    ID: AA, Name: SeDenyNetworkLogonRight, 
    Users: ['Guests'] }
    - { Desc: Deny guests local log on,
    ID: BB, Name: SeDenyInteractiveLogonRight, 
    Users: ['Guests'] }
    - { Desc: Allow force shutdown via remote to Admins,
    ID: CC, Name: SeRemoteShutdownPrivilege, 
    Users: ['Administrators'] }
    - { Desc: Allow security audit generation for Local Service and Network Service,
    ID: DD, Name: SeAuditPrivilege, 
    Users: ['Local Service','Network Service'] }
    - { Desc: Allow client impersonation for ,
    ID: EE, Name: SeImpersonatePrivilege, 
    Users: ['Administrators','Service','Local Service','Network Service'] }
    - { Desc: Allow scheduling priority changes to Admins,
    ID: FF, Name: SeIncreaseBasePriorityPrivilege, 
    Users: ['Administrators'] }
    - { Desc: Restrict driver device loading/unloading to Admins,
    ID: GG, Name: SeLoadDriverPrivilege, 
    Users: ['Administrators'] }
    - { Desc: Prevent anyone from modifying object labels,
    ID: HH, Name: SeRelabelPrivilege, 
    Users: [] }
    - { Desc: Allow system performance profiling for Admins and NT Service\WdiServiceHost,
    ID: II, Name: SeSystemProfilePrivilege, 
    Users: ['Administrators','NT SERVICE\WdiServiceHost'] }
    - { Desc: Restrict system shutdown to Admins,
    ID: NN, Name: SeShutdownPrivilege, 
    Users: ['Administrators'] }
    - { Desc: "Deny RDP log on for Guests, Local Account and Domain Admins (we only deny Guests)",
    ID: NN, Name: SeTcbPrivilege, 
    Users: ['Guests'] }

# Init and get defaults
- name: Check if defaults were loaded for UN_AC_3 were loaded
  set_fact:
    Loaded_UN_AC_3: "{{ 'UN_AC_3' in MachineDefaults }}"

- name: Initialize UndoList
  set_fact:
    UndoList: "{{ UndoList + ['UN_AC_3_'+item.ID] }}"
  loop: "{{ UN_AC_3_RegTasks |union(UN_AC_3_RightsTasks) }}"
  when: "'UN_AC_3' in UndoList"

- name: Get regedit defaults
  include_tasks: WinRegStat.yml
  vars:
    SecCat: UN
    TaskCat: AC_3
    RegTasks: "{{ UN_AC_3_RegTasks }}"
  when: not Loaded_UN_AC_3

# Run tasks
- name: Run regedit tasks
  include_tasks: WinRegedit.yml
  vars:
    SecCat: UN
    TaskCat: AC_3
  loop: "{{ UN_AC_3_RegTasks }}"
  loop_control:
    loop_var: RegTask

- name: Run user rights tasks # simultaneously saves defaults
  include_tasks: WinUserRights.yml
  vars:
    SecCat: UN
    TaskCat: AC_3
    Loaded: Loaded_UN_AC_3
    RightsTasks: "{{ UN_AC_3_RightsTasks }}"


# #Tasks
# - name: UN_AC_3 A > Restrict use of blank passwords
#   win_regedit:
#     path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
#     name: LimitBlankPasswordUse
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.A }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.A == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_A is not defined

# - name: UN_AC_3 B > Prevent printer driver installation for non-admins
#   win_regedit:
#     path: HKLM:\SYSTEM\CurrentControlSet\Control\Print\Providers\LanMan Print Services\Servers
#     name: AddPrinterDrivers
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.B }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.B == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_B is not defined

# - name: UN_AC_3 C > Enforce encrypted or signed channel data
#   win_regedit:
#     path: HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters
#     name: RequireSignOrSeal
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.C }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.C == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_C is not defined

# - name: UN_AC_3 D > Enforce encrypted of signed channel data
#   win_regedit:
#     path: HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters
#     name: SignSecureChannel
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.D }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.D == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_D is not defined

# - name: UN_AC_3 E > Do not display last user name
#   win_regedit:
#     path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
#     name: dontdisplaylastusername
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.E }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.E == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_E is not defined

# - name: UN_AC_3 F > Require CTRL + ALT + DEL to logon
#   win_regedit:
#     path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
#     name: disabledcad
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.F }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.F == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_F is not defined

# - name: UN_AC_3 G > Enforce digital signing of communications (Workstation)
#   win_regedit:
#     path: HKLM:\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters
#     name: EnableSecuritySignature
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.G }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.G == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_G is not defined

# - name: UN_AC_3 H > Enforce digital signing of communications (Server)
#   win_regedit:
#     path: HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters
#     name: enablesecuritysignature
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.H }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.H == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_H is not defined

# - name: UN_AC_3 I > Allow SafeDLL search mode
#   win_regedit:
#     path: HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager
#     name: SafeDllSearchMode
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.I }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.I == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_I is not defined

# - name: UN_AC_3 J > Set screen saver grace period to 4
#   win_regedit:
#     path: HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon
#     name: ScreenSaverGracePeriod
#     data: "{{ 4 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.J }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.J == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_J is not defined

# - name: UN_AC_3 K > Prevent SAM account searching
#   win_regedit:
#     path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
#     name: restrictanonymoussam
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.K }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.K == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_K is not defined

# - name: UN_AC_3 L > Restrict anonymous user permissions
#   win_regedit:
#     path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
#     name: everyoneincludesanonymous
#     data: "{{ 0 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.L }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.L == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_L is not defined

# - name: UN_AC_3 M > Restrict anonymous access to pipes
#   win_regedit:
#     path: HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters
#     name: restrictnullsessaccess
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.M }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.M == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_M is not defined

# - name: UN_AC_3 N > Enforce LDAP client signing
#   win_regedit:
#     path: HKLM:\SYSTEM\CurrentControlSet\Services\ldap
#     name: ldapclientintegrity
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.N }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.N == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_N is not defined

# - name: UN_AC_3 O > Allow system shutdown without logon
#   win_regedit:
#     path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
#     name: shutdownwithoutlogon
#     data: "{{ 0 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.O }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.O == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_O is not defined

# - name: UN_AC_3 P > Prevent unsecure elevation prompts from applications
#   win_regedit:
#     path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
#     name: EnableUIADesktopToggle
#     data: "{{ 0 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.P }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.P == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_P is not defined

# - name: UN_AC_3 Q > Prevent application installation without prompt
#   win_regedit:
#     path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
#     name: EnableInstallerDetection
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.Q }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.Q == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_Q is not defined

# - name: UN_AC_3 R > Run admins in Admin Approval Mode
#   win_regedit:
#     path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
#     name: EnableLUA
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.R }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.R == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_R is not defined

# - name: UN_AC_3 S > Enforce secure desktop for elevation prompts
#   win_regedit:
#     path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
#     name: PromptOnSecureDesktop
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.P }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.P == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_P is not defined

# - name: UN_AC_3 T > Restrict legacy application registry write locations
#   win_regedit:
#     path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
#     name: EnableVirtualization
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.T }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.T == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_T is not defined

# # The following tasks are by Kevin's security_policy.yml and
# # security_policy.inf.jinja scripts
# # UN_AC_3 U > Prohibit anything from acting as the Operating System
# # UN_AC_3 V > Allow local logon to Admins
# # UN_AC_3 W > Restrict system time changes to Admins and Local Service
# # UN_AC_3 X > Restrict creating pagefiles to Admins
# # UN_AC_3 Y > Restrict creating symbolic links to Admins
# # UN_AC_3 Z > Prohibit network access to computer for Guests and Local Account
# # UN_AC_3 AA > Prohibit local logon for Guests
# # UN_AC_3 BB > Restrict remote shutdown to Admins
# # UN_AC_3 CC > Restrict generating security audits to Local Service and Network Service
# # UN_AC_3 DD > Restrict client impersonation to 
# #     Administrators, SERVICE, Local Service, Network Service
# # UN_AC_3 EE > Restrict scheduling priority to Admins
# # UN_AC_3 FF > Restrict device driver loading to Admins
# # UN_AC_3 GG > Restrict managing audits and security logs to Admins
# # UN_AC_3 HH > Prohibit modifying object labels for everyone
# # UN_AC_3 II > Restrict modifying firmware environment to Admins
# # UN_AC_3 JJ > Restrict volume maintenance to Admins
# # UN_AC_3 KK > Restrict profiling performance to Admins, NT Service, and WdiServiceHost
# # UN_AC_3 LL > Restrict file and dir restoration to Admins
# # UN_AC_3 MM > Restrict shutdown to Admins
# # UN_AC_3 NN > Prohibit RDP logon for Guests

# - name: UN_AC_3 OO > Prevent Microsoft accounts from logging in
#   win_regedit:
#     path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
#     name: noconnecteduser
#     data: "{{ 3 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.OO }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.OO == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_OO is not defined

# - name: UN_AC_3 PP > Prohibit server controllers from scheduling tasks
#   win_regedit:
#     path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
#     name: submitcontrol
#     data: "{{ 0 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.PP }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.PP == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_PP is not defined

# - name: UN_AC_3 QQ > Prohibit anonymous access to names pipes
#   win_regedit:
#     path: HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters
#     name: NullSessionPipes
#     data: "{{ '' if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.QQ }}"
#     type: multistring
#     state: "{{'absent' if ( undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.QQ == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_QQ is not defined

# - name: UN_AC_3 RR > Prohibit anonymous access to session shares
#   win_regedit:
#     path: HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters
#     name: NullSessionShares
#     data: "{{ '' if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.RR }}"
#     type: multistring
#     state: "{{'absent' if ( undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.RR == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_RR is not defined

# - name: UN_AC_3 SS > Prevent last user's credentials from being stored
#   win_regedit:
#     path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
#     name: DisableAutomaticRestartSignOn
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.SS }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.SS == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_SS is not defined

# - name: UN_AC_3 TT > Require authentication for RPC service access
#   win_regedit:
#     path: HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Rpc
#     name: EnableAuthEpResolution
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.TT }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.TT == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_TT is not defined

# - name: UN_AC_3 UU > Require Domain Controller Authentication to unlock computer
#   win_regedit:
#     path: HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon
#     name: ForceUnlockLogon
#     data: "{{ 1 if undo_UN_AC_3 is not defined else RegistryDefaults.UN_AC_3.TT }}"
#     type: dword
#     state: "{{'absent' if (undo_UN_AC_3 is defined and RegistryDefaults.UN_AC_3.TT == 4294967295) else 'present'}}"
#   when: skip_UN_AC_3_TT is not defined