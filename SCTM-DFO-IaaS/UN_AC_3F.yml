# List Script 
# Fake script to test the WinRegedit Task File
---
- hosts: all
  become_method: runas
  vars:
    MachineDefaults: {}
    MachineDefaultsPath: C:\AnsibleMachineDefaults.yml
  tasks:

  - name: Initialize template facts
    set_fact:
      Skips: "{{ Skips|default(['HeheXD']) }}"
      Rollbacks: "{{ Rollbacks|default(['Metroid']) }}"
      Customs: "{{ Customs|default({}) }}"

  - name: Initialize MachineDefaults dictionary
    include_tasks: WinDefaultsFile.yml

# Regedit example
  - name: Set AC_3F regedit tasks dictionary
    set_fact:
      AC_3F_RegTasks:
        - { ID: A, Value: 1, RegType: dword, RegName: LimitBlankPasswordUse, 
        RegPath: 'HKLM:\SYSTEM\CurrentControlSet\Control\Lsa', 
        Desc: 'Restrict use of blank passwords'}
        - { ID: B, Value: 1, RegType: dword, RegName: AddPrinterDrivers, 
        RegPath: 'HKLM:\SYSTEM\CurrentControlSet\Control\Print\Providers\LanMan Print Services\Servers', 
        Desc: 'Prevent printer driver installation for non-admins'}

  - name: Get regedit Defaults
    include_tasks: WinRegStat.yml
    vars:
      SecCat: UN
      TaskCat: AC_3F
      RegTasks: "{{ AC_3F_RegTasks }}"
    when: "not \"UN_AC_3F\" in MachineDefaults"

  - name: Run regedit Tasks
    include_tasks: WinRegedit.yml
    vars:
      SecCat: UN
      TaskCat: AC_3F
    loop: "{{ AC_3F_RegTasks }}"
    loop_control:
      loop_var: RegTask

# User rights example
  - name: Set AC_3F user rights tasks dictionary
    set_fact:
      AC_3F_Rights:
        - { ID: C, Name: SeTcbPrivilege, Users: [],
        Desc: Set no one to act as part of the operating system }
        # Default []
        - { ID: D, Name: SeInteractiveLogonRight, Users: ['Administrators'],
        Desc: Only allow admins to log on locally }
        # Default ['Administrators','Users','Backup Operators']

  - name: Run user rights tasks
    include_tasks: WinUserRights.yml
    vars:
      SecCat: UN
      TaskCat: AC_3F
      RightsTasks: "{{ AC_3F_Rights }}"