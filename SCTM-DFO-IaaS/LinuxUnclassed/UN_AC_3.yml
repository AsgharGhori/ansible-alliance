# == List Script ==
# Includes all the tasks that fall under
# the Unclassed AC-3 protocol requirements

# Expected vars/facts:
# - MachineDefaults {} (populated)
---
# - name: UN_AC_3 A > Copying /etc/motd file (TBS compliance)
#   copy:
#     src: LinuxUnclassed/motd
#     dest: /etc/
#     owner: root
#     group: root
#     mode: 0600

# - name: UN_AC_3 A > Creating a motd file
#   file:
#     path: /etc/motd
#     state: "{{ 'touch' if 'UN_AC_3_A' not in UndoList else 'absent' }}"
#     mode: 0600
#   register: fileState
#   when: not 'UN_AC_3_A' in SkipList

- name: UN_AC_3 A > Write file contents
  copy:
    dest: /etc/motd
    mode: 0600
    content: "\n\t\t   Fisheries and Oceans Canada / Pêches et Océans Canada
    \n\n\t\tUnauthorized Access Prohibited / Accès non-autorisé interdit\n"
  when: not 'UN_AC_3_A' in SkipList


# - name: UN_AC_3 B > Copying /etc/issue file (TBS compliance)
#   copy:
#     src: LinuxUnclassed/issue
#     dest: /etc/
#     owner: root
#     group: root
#     mode: 0600

# - name: UN_AC_3 C > Copying /etc/issue.net file (TBS compliance)
#   copy:
#     src: LinuxUnclassed/issue.net
#     dest: /etc/
#     owner: root
#     group: root
#     mode: 0600

# - name: Adding execute permission bit to the directory that stores
#     user login message files (TBS compliance)
#   file:
#     path: /etc/update-motd.d
#     mode: 0755
#   when: ansible_distribution == "Ubuntu"

# - name: Get all files in /etc/update-motd.d
#   find:
#     paths: /etc/update-motd.d
#     file_type: file
#     recurse: yes
#   register: motdfiles
#   when: ansible_distribution == "Ubuntu"

# - name: Removing execute permission bit from files that display messages
#     at user login (TBS compliance)
#   file:
#     path: "{{ item.path }}"
#     mode: 0644
#   with_items: "{{ motdfiles.files }}"
#   when: ansible_distribution == "Ubuntu"