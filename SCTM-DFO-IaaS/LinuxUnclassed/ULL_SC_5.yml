# == List Script ==
# Includes all the tasks that fall under the
# Unclassed-Low-Low SC-5 protocol requirements

# Expected vars/facts:
# - MachineDefaults {} (populated)
---
# Init task dictionaries
- name: Set SC-5 file editing tasks
  set_fact:
    ULL_SC_5_SwapTasks:
    - { Desc: Disable 'chargen' in config file,
      ID: A, Value: 'yes', Path: /etc/xinetd.d/chargen,
      Regex: "service\\s(chargen)\\n{\\n\\s+disable\\s+=\\s(yes|no)",
      Replace: "service chargen\n{\n        disable         = " }
    - { Desc: Disable 'echo' in config file,
      ID: B, Value: 'yes', Path: /etc/xinetd.d/echo,
      Regex: "service\\s(echo)\\n{\\n\\s+disable\\s+=\\s(yes|no)",
      Replace: "service echo\n{\n        disable         = " }

# - name: Dynamically append folder files to SwapTasks dictionary



# - name: Disable chargen from running
#   replace:
#     path: /etc/xinetd.d/chargen
#     regexp: "service\\s(chargen)\\n{\\n\\s+disable\\s+=\\s(yes|no)"
#     line: "service chargen\n{\n        disable         = yes"
#     state: present

# Init and get defaults
- name: Check if defaults for SC-5 were loaded
  set_fact:
    Loaded_ULL_SC_5: "{{ 'ULL_SC_5' in MachineDefaults }}"

- name: Initialize UndoList
  set_fact:
    UndoList: "{{ UndoList + ['ULL_SC_5_'+item.ID] }}"
  loop: "{{ ULL_SC_5_SwapTasks }}"
  when: "'ULL_SC_5' in UndoList"

- name: Get SC-5 file replacement defaults
  include_tasks: TaskScripts/LinuxDefaultText.yml
  vars:
    SecCat: ULL
    TaskCat: SC_5
    SwapTasks: "{{ ULL_SC_5_SwapTasks }}"
  when: not Loaded_ULL_SC_5

# Run tasks
- name: Run SC-5 file editing tasks
  include_tasks: TaskScripts/LinuxReplace.yml
  vars:
    SecCat: ULL
    TaskCat: SC_5
  loop: "{{ ULL_SC_5_SwapTasks }}"
  loop_control:
    loop_var: SwapTask