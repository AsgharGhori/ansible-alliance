---
# Called from Windows-Unclassed.yml
# Includes all the tasks that fall under
# the IA-5 protocol requirements

- name: IA-5 A > Allow domain members to change their account passwords
  win_regedit:
    path: HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters
    name: DisablePasswordChange
    data: 0
    type: dword

- name: IA-5 B > Prevent plaintext storage of credentials
  win_regedit:
    path: HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest
    name: UseLogonCredential
    data: 0
    type: dword

- name: IA-5 C > Enforce better client authentication than 'Basic'
  win_regedit:
    path: HKLM:\SOFTWARE\Policies\Microsoft\Windows\WinRM\Client
    name: AllowBasic
    data: 0
    type: dword

- name: IA-5 D > Enforce better client authentication than 'Digest'
  win_regedit:
    path: HKLM:\SOFTWARE\Policies\Microsoft\Windows\WinRM\Client
    name: AllowDigest
    data: 0
    type: dword

- name: IA-5 E > Enforce better service authentication than 'Basic'
  win_regedit:
    path: HKLM:\SOFTWARE\Policies\Microsoft\Windows\WinRM\Service
    name: AllowBasic
    data: 0
    type: dword

- name: IA-5 F > Prevent storage of RunAs credentials
  win_regedit:
    path: HKLM:\SOFTWARE\Policies\Microsoft\Windows\WinRM\Service
    name: DisableRunAs
    data: 1
    type: dword

- name: IA-5 G > Ensure installation of password handling extension
  win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GPExtensions\{D76B9641-3288-4f75-942D-087DE603E3EA}
    name: DllName
    data: C:\Program Files\LAPS\CSE\AdmPwd.dll
    type: string

- name: IA-5 H > Restrict password expiration time
  win_regedit:
    path: HKLM:\SOFTWARE\Policies\Microsoft Services\AdmPwd
    name: PwdExpirationProtectionEnabled
    data: 1
    type: dword

- name: IA-5 I > Set local admin to manage password
  win_regedit:
    path: HKLM:\SOFTWARE\Policies\Microsoft Services\AdmPwd
    name: AmdPwdEnabled
    data: 1
    type: dword

- name: IA-5 J > Enforce password complexity
  win_regedit:
    path: HKLM:\SOFTWARE\Policies\Microsoft Services\AdmPwd
    name: PasswordComplexity
    data: 1
    type: dword

- name: IA-5 K > Set min password length to 15
  win_regedit:
    path: HKLM:\SOFTWARE\Policies\Microsoft Services\AdmPwd
    name: PasswordLength
    data: 15
    type: dword

- name: IA-5 L > Enforce changing passwords every 30 days minimum
  win_regedit:
    path: HKLM:\SOFTWARE\Policies\Microsoft Services\AdmPwd
    name: PasswordAgeDays
    data: 30
    type: dword