# == Task Script ==
# Contains tasks for writing to files on a Linux host

# Expected vars/facts:
# - MachineDefaults {} (empty or populated)
# - SecCat
# - TaskCat
# - ChmodTask {} (looped)
#   - ID
#   - Desc
#   - Path
#   - Recurse
#   - Mode
#   - Owner
#   - Group
---
- set_fact:
    fullID: "{{ SecCat+'_'+TaskCat+'_'+ChmodTask.ID }}"

- name: "{{ SecCat+'_'+TaskCat+' '+ChmodTask.ID+' > '+ChmodTask.Desc }}"
  file:
    path: "{{ ChmodTask.Path }}"
    mode: "{{ ( ChmodTask.Mode if fullID not in CustomDict
      else CustomDict[fullID] ) if fullID not in UndoList
      else MachineDefaults[SecCat+'_'+TaskCat][ChmodTask.ID] }}"
    owner: "{{ ChmodTask.Owner }}"
    group: "{{ ChmodTask.Group }}"
    state: "{{ 'file' if ChmodTask.Directory is not defined and 
    ChmodTask.Recurse is not defined else 'directory' }}"
    recurse: "{{ 'yes' if ChmodTask.Recurse is defined else 'no' }}"
  when: not fullID in SkipList