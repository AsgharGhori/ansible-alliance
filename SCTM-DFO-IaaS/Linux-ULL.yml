# == Orchestrator Script ==
# STCM-DFO-IaaS compliant configuration for
# a Linux virtual machine in Azure Cloud
# Based on RFP 16-42051B <- Check if true

# A Linux VM in Azure Cloud with this
# configuration may contain Government of
# Canada Unclassed-Low-Low information
---
- hosts: all
  become: yes
  become_method: sudo
  vars:
    MachineDefaults: {}
    MachineDefaultsPath: /etc/AnsibleMachineDefaults.yml
    SkipList: "{{ Skip|default([]) }}"
    UndoList: "{{ Undo|default([]) }}"
    CustomDict: "{{ Custom|default({}) }}"
    IsLinux: "{{ (hostvars[inventory_hostname].ansible_system == 'Linux')|bool }}"
  tasks:

  - name: Initialize template facts
    set_fact:
      OnlyRun: "{{ OnlyRun|default('None') }}"

  - name: Initialize MachineDefaults dictionary
    include_tasks: TaskScripts/LinuxMachineDefaults.yml

  - name: Initialize SkipList array
    include_tasks: TaskScripts/InitSkips.yml

  - name: Initialize UndoList array
    include_tasks: TaskScripts/InitUndos.yml

#========== List Script Includes ==========#
  # AC
  - name: Execute ULL_AC_3 tasks
    include_tasks: LinuxUnclassed/ULL_AC_3.yml
    when: "'ULL_AC_3' not in SkipList"
  
  # - name: Execute UN_AC_8 tasks
  #   include_tasks: LinuxUnclassed/UN_AC_8.yml
  #   when: "'UN_AC_8' not in SkipList"